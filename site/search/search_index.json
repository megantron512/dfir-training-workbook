{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the Datadog Cloud DFIR Training!","text":"<p>In this week's training we will be learning how to investigate cloud-based incidents. Throughout the training you will have the opportunity to get hands-on experience by working through a series of labs. Some of these labs will be focused on individual techniques while some will present an end-to-end attack scenario.</p>"},{"location":"aws/lab1/","title":"Lab 1: AWS Authentication at Datadog","text":"<p>This lab is to begin understanding what authentication looks like in the logs when users accesss AWS using SSO. </p> <p>Before walking through the questions below, navigate to the AWS access portal and search for the <code>datadog-dfir-training-2025</code> account. Access it using the <code>security-admin</code> role. Within a few minutes, associated logs should be generated and shipped to the Datadog.</p>"},{"location":"aws/lab1/#goal","title":"Goal","text":"<p>The primary goal of this lab is to identify all event types that are generated when a Datadog user signs in with SSO. The upcoming slides in the training will go into detail about these events, but see what you can find yourself before we cover any gaps! </p> <p>If you think you've identified all relevant log entries, as a bonus challenge, identify other types of authentication that are occuring and notable properties associated with those events that could assist in investigating malicious activity. </p>"},{"location":"gcp/service_account_abuse/","title":"Default Service Account Abuse in Google Cloud","text":""},{"location":"gcp/service_account_abuse/#background","title":"Background","text":"<p>SIRT has received a Google Cloud Instance Creation via gcloud signal that has been determined to be suspicious/malicious. Investigate the signal and determine how the threat actor accessed the environment and what they did with their access.</p>"},{"location":"gcp/service_account_abuse/#logs","title":"Logs","text":"<p>The logs for this lab fall within the following time frame: <code>&lt;tbd&gt;</code>. We can use the following filter to focus on the CloudTrail logs in the relevant AWS account: <code>source:gcp* project_id:datadog-dfir-training-2025</code> </p> <p>Don't forget that there are some logs that don't make it to Datadog that might be worth exploring within Google Cloud Console.</p>"},{"location":"gcp/service_account_abuse/#investigation","title":"Investigation","text":"<p>Start by reviewing the signal and identifying noteworthy properties that might act as pivot points to discover related activity. </p> What indicators can help us track the relevant activity? Hint <p>Take note of the following properties:   </p> <ul> <li>IP address  </li> <li>User ID   </li> <li>Entities (related resources)  </li> </ul> Answer <ul> <li>IP address: <code>1.1.1.1</code></li> <li>User ID: <code>research-512-serivce-account@datadog-dfir-training-2025.iam.gserviceaccount.com</code></li> <li>Related resources:   <ul> <li>GCE INSTANCE 1</li> <li>GCE INSTANCE 2</li> <li>GCE INSTANCE 3</li> </ul> </li> </ul> <p>A good starting point is to understand the nature of the activity is to identify what the service account was used for.</p> What actions did the service account associated with the signal take? Hint <p>Look at the event names associated with activity where the user ID is <code>research-512-serivce-account@datadog-dfir-training-2025.iam.gserviceaccount.com</code>. You can either do this with grouping by fields in Log Explorer or using Investigator against the service account. </p> Answer <p>There are 6 different event types associated with this account:   </p> <ul> <li><code>v1 compute.instances.insert</code> </li> <li><code>iam.serviceAccounts.actAs</code></li> <li><code>v1.compute.instances.get</code></li> <li><code>v1.compute.projects.get</code></li> <li><code>v1.compute.zoneOperations.wait</code> </li> <li><code>v1.compute.zones.get</code> </li> </ul> <p>Most of the associated events are read-only activity, so let's focus on the first event type: <code>v1 compute.instances.insert</code>. This indicates attempts to deploy virtual machines on Google Cloud Compute.</p> How many virtual machines were deployed and hat are their instance names/IDs? Hint <p>Further filter the search for the project and service account using <code>@evt.name:v1 compute.instances.insert</code>. Look at <code>@data.protoPayload.resourceName</code> and <code>@data.resource.labels.instance_id</code> for the resource names and instance IDs.</p> Answer <ul> <li><code>instance-1</code> (ID ) <li><code>instance-2</code> (ID ) <li><code>instance-3</code> (ID ) <p>The logs don't provide full context. Let's look directly in Google Cloud at the virtual machines to see if there is anything interesting about the hosts that might point to attacker intent.</p> What interesting instance details could point to attacker intent? Hint <p>Look at the <code>Machine configuration</code> and <code>Custom metadata</code>.</p> Answer <p>There's two key details of interest here:  </p> <ol> <li>The host has GPUs attached. Attackers often create GPU-enabled VMs for the purpose of cryptomining.</li> <li>There is a <code>startup-script</code> key with a bash script that downloads a file from a remote host and executes it.</li> </ol> <p>Now we've determined that the threat actor's intention was likely to leverage our compute infrastructure for cryptomining or another malicious activity, we should work backwards to determine how this service account was compromised in the first place. </p> How did the threat actor authenticate the service account? Hint <p>Look at <code>@data.protoPayload.authenticationInfo</code> in any of the logs associated with the account's activity.</p> Answer <p>The authenticationInfo field shows that there is an associated <code>serviceAccountKeyName</code>, indicating a key exists for the service account and was used to authenticate the user of the account.</p> What is the scope of access that this account has? Hint <p>Use Policy Analyzed in Google Cloud to understand the service account's permissions. </p> Answer <p>The service account has an Editor role grant on the project <code>Datadog Dfir Training 2025</code>.</p> <p>It appears the threat actor has gotten a copy of a service account key in order to leverage the account's editor permissions to carry out their attack. Now we need to determine how the threat actor obtained access to the key. </p>"}]}